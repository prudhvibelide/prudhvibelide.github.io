<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Conference Services ‚Ä¢ eDesk</title>
  <style>
    :root{
      --gold:#cfb87c;
      --gold-2:#bfa766;
      --panel:#1b1b1c;
      --panel-2:#242425;
      --panel-3:#2c2c2e;
      --text:#e9e9e9;
      --muted:#bdbdbd;
      --subtle:#8a8a8a;
      --ok:#3aafa9;
      --warn:#e79a00;
      --bad:#c03737;
      --shadow:0 14px 28px rgba(0,0,0,.35), 0 10px 10px rgba(0,0,0,.28);
      --radius-lg:18px;
      --border:#2f2f31;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Segoe UI", system-ui, -apple-system, Roboto, Helvetica, Arial;
      color:var(--text);
      background: radial-gradient(1200px 650px at 15% 10%, #1b1b1c 0%, #111 60%, #0b0b0c 100%);
      background-attachment:fixed;
    }

    .container{max-width:1200px; margin:26px auto; padding:0 16px}

    /* Header */
    .header{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px; margin-bottom:14px;
    }
    .brand{display:flex; align-items:center; gap:14px}
    .brand-badge{
      width:56px;height:56px;border-radius:12px;
      background:var(--gold);
      color:#1a1a1a; font-weight:950; display:grid; place-items:center; font-size:22px;
      box-shadow:var(--shadow);
    }
    .brand h1{margin:0; font-size:26px; letter-spacing:.2px; font-weight:950}
    .brand small{display:block; margin-top:2px; color:var(--muted); font-weight:750}

    .header-actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end}

    .pill{
      padding:8px 12px; border-radius:999px; background:rgba(207,184,124,.14);
      border:1px solid rgba(207,184,124,.35);
      color:var(--gold); font-weight:950; letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
      user-select:none;
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background:var(--gold);
      box-shadow:0 0 0 3px rgba(207,184,124,.18);
      display:inline-block;
    }

    .btn{
      border:none; border-radius:12px; padding:10px 14px; font-weight:950; cursor:pointer;
      background:var(--panel-2); color:#ddd; display:flex; align-items:center; gap:8px;
      box-shadow:0 4px 12px rgba(0,0,0,.35);
    }
    .btn.primary{background:var(--gold); color:#1c1c1c}
    .btn.ghost{background:#2e2e30; color:#e6e6e6}
    .btn:hover{filter:brightness(1.06)}
    .btn:disabled{opacity:.55; cursor:not-allowed}

/* Confetti burst */
.confetti {
  position: fixed;
  width: 10px;
  height: 14px;
  border-radius: 3px;
  pointer-events: none;
  z-index: 9999;
  opacity: 0.95;
  transform: translate(-50%, -50%);
  animation: confettiFly 900ms ease-out forwards;
}
@keyframes confettiFly {
  0%   { transform: translate(-50%, -50%) translate(0,0) rotate(0deg); opacity: 1; }
  100% { transform: translate(-50%, -50%) translate(var(--dx), var(--dy)) rotate(var(--rot)); opacity: 0; }
}

    /* Countdown */
    .countdown{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(207,184,124,.35);
      background:linear-gradient(180deg, rgba(207,184,124,.18) 0%, rgba(207,184,124,.10) 100%);
      color:#f1e7c8;
      box-shadow:0 10px 18px rgba(0,0,0,.35);
      cursor:pointer;
      user-select:none;
      position:relative;
      overflow:hidden;
      font-weight:950;
    }
    .countdown small{
      display:block;
      font-size:11px;
      letter-spacing:.25px;
      color:rgba(233,233,233,.8);
      font-weight:850;
      margin-top:2px;
    }
    .countdown .time{
      font-variant-numeric:tabular-nums;
      letter-spacing:.35px;
      font-size:13px;
      color:#fff;
      font-weight:950;
    }
    .countdown::after{
      content:"";
      position:absolute;
      inset:-2px;
      background:radial-gradient(280px 120px at 15% 20%, rgba(207,184,124,.25) 0%, rgba(207,184,124,0) 60%);
      opacity:.9;
      pointer-events:none;
    }
    @keyframes popGlow{
      0%{transform:translateY(0) scale(1); filter:brightness(1)}
      35%{transform:translateY(-2px) scale(1.02); filter:brightness(1.12)}
      70%{transform:translateY(0) scale(1.01); filter:brightness(1.08)}
      100%{transform:translateY(0) scale(1); filter:brightness(1)}
    }
    @keyframes shimmerSweep{
      0%{transform:translateX(-120%)}
      100%{transform:translateX(120%)}
    }
    .countdown.celebrate{
      animation:popGlow .45s ease-out;
    }
    .countdown .shine{
      position:absolute;
      top:0; bottom:0;
      width:60%;
      left:-80%;
      background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.22) 45%, rgba(255,255,255,0) 100%);
      transform:skewX(-18deg);
      pointer-events:none;
      opacity:0;
    }
    .countdown.celebrate .shine{
      opacity:1;
      animation:shimmerSweep .55s ease-out;
    }

    /* Home hero */
    .hero{
      background:
        radial-gradient(600px 260px at 10% 10%, rgba(207,184,124,.18) 0%, rgba(207,184,124,0) 60%),
        linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%);
      border:1px solid var(--border);
      border-radius:var(--radius-lg);
      padding:22px;
      box-shadow:var(--shadow);
      margin-bottom:16px;
      position:relative;
      overflow:hidden;
    }
    .hero::after{
      content:"";
      position:absolute; right:-120px; top:-120px;
      width:320px; height:320px;
      border-radius:80px;
      background:rgba(207,184,124,.08);
      border:1px solid rgba(207,184,124,.12);
      transform:rotate(18deg);
      pointer-events:none;
    }
    .hero-title{
      font-size:40px;
      line-height:1.05;
      font-weight:980;
      margin:0 0 10px 0;
      letter-spacing:.2px;
    }
    .hero-desc{
      margin:0;
      color:var(--muted);
      font-weight:700;
      line-height:1.35;
      max-width:900px;
    }

    /* Halls horizontal row */
    .hall-row{
      display:flex;
      gap:14px;
      margin-top:16px;
      padding-bottom:10px;
      overflow-x:auto;
      overscroll-behavior-x:contain;
      scroll-snap-type:x mandatory;
    }
    .hall-row::-webkit-scrollbar{height:10px}
    .hall-row::-webkit-scrollbar-thumb{background:#2f2f31; border-radius:999px}
    .hall-row::-webkit-scrollbar-track{background:#1a1a1a; border-radius:999px}

    .hall-card{
      flex:0 0 260px;
      scroll-snap-align:start;
      background:linear-gradient(180deg, var(--panel-2) 0%, #212122 100%);
      border:1px solid #303033;
      border-radius:16px;
      padding:16px;
      box-shadow:0 10px 18px rgba(0,0,0,.35);
      cursor:pointer;
      transition:transform .08s ease, filter .08s ease;
      position:relative;
      overflow:hidden;
      min-height:98px;
    }
    .hall-card:hover{filter:brightness(1.05); transform:translateY(-1px)}
    .hall-card .kicker{color:var(--gold); font-weight:980; letter-spacing:.3px; font-size:12px}
    .hall-card .name{font-size:18px; font-weight:980; margin:8px 0 0}
    .hall-card .sub{margin:6px 0 0; color:#cfcfcf; font-weight:650; font-size:13px}
    .hall-card .notif{
      position:absolute; right:14px; top:14px;
      width:12px; height:12px; border-radius:999px;
      background:var(--gold);
      box-shadow:0 0 0 4px rgba(207,184,124,.18);
      display:none;
    }
    .hall-card.new .notif{display:block}

    /* Home feed */
    .feed{
      margin-top:18px;
      background:linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border:1px solid var(--border);
      border-radius:var(--radius-lg);
      padding:16px;
      box-shadow:var(--shadow);
    }
    .feed-head{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .feed-title{
      font-size:18px;
      font-weight:980;
      letter-spacing:.2px;
      margin:0;
    }
    .feed-sub{
      color:var(--subtle);
      font-weight:700;
      margin:2px 0 0;
      font-size:13px;
    }
    .feed-list{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .feed-item{
      background:var(--panel-3);
      border:1px solid #3a3a3d;
      border-radius:14px;
      padding:12px;
    }
    .feed-top{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:5px 10px;
      border-radius:999px;
      background:rgba(207,184,124,.14);
      border:1px solid rgba(207,184,124,.28);
      color:var(--gold);
      font-weight:950;
      font-size:12px;
      white-space:nowrap;
    }
    .chip.gray{
      background:#2f2f31;
      border-color:#3a3a3d;
      color:#d4d4d6;
      font-weight:850;
    }
    .feed-msg{
      margin:0;
      color:#e9e9e9;
      font-weight:700;
      line-height:1.32;
      white-space:pre-wrap;
    }
    .feed-meta{
      margin:10px 0 0;
      color:var(--subtle);
      font-weight:700;
      font-size:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .feed-item.new{
      border-color:rgba(207,184,124,.45);
      box-shadow:0 0 0 3px rgba(207,184,124,.10);
    }
    .empty{
      padding:14px;
      border-radius:14px;
      background:#202022;
      border:1px dashed #3a3a3d;
      color:#cfcfcf;
      font-weight:700;
    }

    /* Tabs and Hall area */
    .tabs{display:flex; flex-wrap:wrap; gap:10px; margin:14px 0 12px}
    .tab{
      background:var(--panel-2); color:#cfcfcf; border:1px solid #2f2f31;
      padding:10px 14px; border-radius:12px; font-weight:980; cursor:pointer;
      display:flex; align-items:center; gap:8px; box-shadow:0 8px 16px rgba(0,0,0,.35);
      user-select:none;
    }
    .tab.active{background:var(--gold); color:#1a1a1a; border-color:transparent}

    .section{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius-lg);
      padding:18px;
      box-shadow:var(--shadow);
    }
    .section-header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .section-title{font-size:20px; font-weight:980}

    .search{
      display:flex; align-items:center; gap:10px; background:var(--panel-3);
      border-radius:12px; padding:10px 12px; border:1px solid #38383a;
      margin:10px 0 14px;
    }
    .search input{flex:1; background:transparent; border:none; outline:none; color:#e7e7e7; font-weight:700}

    .stats{
      display:grid;
      grid-template-columns:repeat(6, minmax(0,1fr));
      gap:10px;
      margin:12px 0 14px;
    }
    .stat{
      background:linear-gradient(180deg, var(--panel-2) 0%, #212122 100%);
      border:1px solid #303033;
      border-radius:16px;
      padding:12px;
      box-shadow:0 10px 18px rgba(0,0,0,.35);
    }
    .stat .label{color:var(--subtle); font-weight:850; font-size:12px}
    .stat .value{font-size:20px; font-weight:980; margin-top:6px}
    .stat.highlight{
      border-color:rgba(207,184,124,.35);
      background:
        radial-gradient(250px 120px at 10% 10%, rgba(207,184,124,.18) 0%, rgba(207,184,124,0) 60%),
        linear-gradient(180deg, var(--panel-2) 0%, #212122 100%);
    }

    table{width:100%; border-collapse:separate; border-spacing:0 10px}
    thead th{
      color:var(--gold); font-size:13px; text-align:left; font-weight:980;
      padding:8px 10px;
    }
    tbody tr{background:var(--panel-2); box-shadow:0 8px 14px rgba(0,0,0,.35)}
    tbody td{
      padding:12px 10px;
      border-top:1px solid #303033; border-bottom:1px solid #303033;
      color:#ddd; vertical-align:top;
      word-break:break-word;
    }
    tbody tr td:first-child{border-left:1px solid #303033; border-top-left-radius:12px; border-bottom-left-radius:12px}
    tbody tr td:last-child{border-right:1px solid #303033; border-top-right-radius:12px; border-bottom-right-radius:12px}

    .badge{
      display:inline-block; padding:4px 10px; border-radius:9px;
      font-size:12px; font-weight:980;
      background:var(--panel-3); color:#eee; border:1px solid #3b3b3d;
      white-space:nowrap;
    }
    .badge.gold{background:rgba(207,184,124,.18); border-color:#6b5a2b; color:var(--gold)}
    .badge.ok{background:#294e4c; border-color:#357572; color:#b8fff7}
    .badge.warn{background:#4d3b12; border-color:#7d5a19; color:#ffd88b}
    .badge.bad{background:#402424; border-color:#6a3535; color:#ffb8b8}
    .badge.gray{background:#3a3a3d; border-color:#4b4b4d; color:#d0d0d2}

    .row-actions{display:flex; gap:10px; align-items:center}
    .icon-btn{
      background:transparent; border:none; cursor:pointer; font-size:18px; color:#cfcfcf
    }
    .icon-btn:hover{color:#fff}

    /* Modal */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:50}
    .modal.active{display:flex}
    .dialog{
      width:min(820px,92vw); background:var(--panel-2);
      border:1px solid #2e2e30; border-radius:16px;
      box-shadow:var(--shadow);
      padding:18px;
    }
    .dialog h3{margin:0 0 10px 0; font-weight:980}
    .form{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .form .full{grid-column:1/-1}
    .form label{
      font-size:12.5px; color:var(--muted); font-weight:980; display:block; margin-bottom:6px;
    }
    .form input,.form select,.form textarea{
      width:100%; background:var(--panel-3); border:1px solid #3a3a3d;
      color:#e8e8e8; border-radius:12px; padding:10px; font-weight:700;
    }
    .form textarea{min-height:110px; resize:vertical}
    .dialog-actions{display:flex; gap:10px; justify-content:flex-end; margin-top:14px}

    a{color:#d7c890; text-decoration:none}
    a:hover{text-decoration:underline}

    @media (max-width: 560px){
      .hero-title{font-size:34px}
      .form{grid-template-columns:1fr}
      .stats{grid-template-columns:repeat(2, minmax(0,1fr))}
      .hall-card{flex-basis:240px}
      .countdown{width:100%; justify-content:space-between}
    }
    @media (max-width: 980px){
      .stats{grid-template-columns:repeat(3, minmax(0,1fr))}
    }
  </style>
</head>
<body>
  <div class="container">

    <div class="header">
      <div class="brand">
        <div class="brand-badge">CU</div>
        <div>
          <h1>Conference Services eDesk</h1>
          <small>University of Colorado Boulder</small>
        </div>
      </div>

      <div class="header-actions">
        <div id="countdown" class="countdown" title="Click for a small effect">
          <span class="shine"></span>
          <div>
            <div>Summer Conference</div>
            <small>Countdown to Aug 20, 2026</small>
          </div>
          <div class="time" id="countdownTime">--d --:--:--</div>
        </div>

        <span class="pill" id="hall-pill" style="display:none;">
          <span id="hall-pill-dot" class="dot" style="display:none;"></span>
          <span id="hall-pill-text"></span>
        </span>

        <button class="btn" id="homeBtn" style="display:none;">üè† <strong>Home</strong></button>
      </div>
    </div>

    <!-- HOME VIEW -->
    <div id="homeView">
      <div class="hero">
        <p class="hero-title">Welcome to Conference Services</p>
        <p class="hero-desc">
          Select a hall to manage call logs, mail, lost and found, desk notes, and documents.
          Desk notes from all halls are shown below for quick updates.
        </p>

        <div class="hall-row" id="hallRow"></div>

        <div class="feed">
          <div class="feed-head">
            <div>
              <p class="feed-title">Desk Notes</p>
              <p class="feed-sub">All halls, newest first</p>
            </div>
            <button class="btn ghost" id="markSeenBtn">‚úì <strong>Mark all seen</strong></button>
          </div>
          <div id="feedList" class="feed-list"></div>
        </div>
      </div>
    </div>

    <!-- HALL VIEW -->
    <div id="hallView" style="display:none;">
      <div class="stats" id="statsRow"></div>

      <div class="tabs" id="tabs"></div>

      <section class="section">
        <div class="section-header">
          <div class="section-title" id="sectionTitle">Desk Notes</div>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <button class="btn ghost" id="clearSearchBtn">üßπ <strong>Clear</strong></button>
            <button class="btn primary" id="addBtn">‚ûï <strong>Add</strong></button>
          </div>
        </div>

        <div class="search">
          <input id="searchInput" placeholder="Search this tab..." />
          üîé
        </div>

        <div id="contentArea"></div>
      </section>
    </div>

  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="dialog">
      <h3 id="modalTitle">Add Entry</h3>
      <div id="modalForm" class="form"></div>
      <div class="dialog-actions">
        <button class="btn ghost" id="modalCancel">Cancel</button>
        <button class="btn primary" id="modalSave">Save</button>
      </div>
    </div>
  </div>

  <script>
    const HALLS = [
      "Williams Village Hall",
      "Farrand Hall",
      "Aden Hall",
      "Kittredge Central Hall",
      "Hallett Hall"
    ];

    const TAB_DEFS = [
      { id:"deskNotes", label:"üìù Desk Notes", title:"Desk Notes" },
      { id:"callLog",  label:"üìû Call Log",   title:"Call Log" },
      { id:"mailList", label:"üì¨ Mail List",  title:"Mail List" },
      { id:"lost",     label:"üîç Lost",       title:"Lost Items" },
      { id:"found",    label:"üßæ Found",      title:"Found Items" },
      { id:"docs",     label:"üìë Documents",  title:"Documents" },
    ];

    const STORE_KEY = "cs_edesk_v4";
    const SEEN_KEY = "cs_edesk_seen_v4";

    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);
    const e = (s)=> String(s ?? "").replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    const ea = (s)=> String(s ?? "").replace(/"/g,'&quot;');

    const store = {
      loadAll(){
        try {
          const raw = localStorage.getItem(STORE_KEY);
          if(!raw) return { halls:{} };
          return JSON.parse(raw);
        } catch {
          return { halls:{} };
        }
      },
      saveAll(data){
        localStorage.setItem(STORE_KEY, JSON.stringify(data));
      },
      ensureHall(data, hallName){
        if(!data.halls) data.halls = {};
        if(!data.halls[hallName]){
          data.halls[hallName] = { callLog:[], mailList:[], lost:[], found:[], deskNotes:[], docs:[] };
        }
        return data;
      }
    };

    const seen = {
      load(){
        try {
          const raw = localStorage.getItem(SEEN_KEY);
          if(!raw) return { deskNotesSeenAt: {} };
          return JSON.parse(raw);
        } catch {
          return { deskNotesSeenAt: {} };
        }
      },
      save(v){ localStorage.setItem(SEEN_KEY, JSON.stringify(v)); },
      getHallSeenAt(hall){
        const s = this.load();
        return Number(s.deskNotesSeenAt?.[hall] || 0);
      },
      setHallSeenAt(hall, ts){
        const s = this.load();
        if(!s.deskNotesSeenAt) s.deskNotesSeenAt = {};
        s.deskNotesSeenAt[hall] = ts;
        this.save(s);
      },
      markAllSeen(ts){
        const s = this.load();
        if(!s.deskNotesSeenAt) s.deskNotesSeenAt = {};
        HALLS.forEach(h => s.deskNotesSeenAt[h] = ts);
        this.save(s);
      }
    };

    function burstConfettiFrom(el) {
  const r = el.getBoundingClientRect();
  const x = r.left + r.width / 2;
  const y = r.top + r.height / 2;

  const colors = ["#cfb87c", "#bfa766", "#e9e9e9", "#3aafa9", "#e79a00"];
  const pieces = 28;

  for (let i = 0; i < pieces; i++) {
    const d = document.createElement("div");
    d.className = "confetti";
    d.style.left = x + "px";
    d.style.top = y + "px";
    d.style.background = colors[Math.floor(Math.random() * colors.length)];

    const dx = (Math.random() * 240 - 120) + "px";
    const dy = (Math.random() * 220 - 140) + "px";
    const rot = (Math.random() * 720 - 360) + "deg";
    d.style.setProperty("--dx", dx);
    d.style.setProperty("--dy", dy);
    d.style.setProperty("--rot", rot);

    document.body.appendChild(d);
    setTimeout(() => d.remove(), 950);
  }
}
    const state = { hall:null, tab:"deskNotes", search:"", editing:null };

    const homeView = document.getElementById("homeView");
    const hallView = document.getElementById("hallView");
    const hallRow = document.getElementById("hallRow");
    const feedList = document.getElementById("feedList");
    const markSeenBtn = document.getElementById("markSeenBtn");

    const hallPill = document.getElementById("hall-pill");
    const hallPillText = document.getElementById("hall-pill-text");
    const hallPillDot = document.getElementById("hall-pill-dot");
    const homeBtn = document.getElementById("homeBtn");

    const tabsEl = document.getElementById("tabs");
    const sectionTitle = document.getElementById("sectionTitle");
    const contentArea = document.getElementById("contentArea");
    const addBtn = document.getElementById("addBtn");
    const searchInput = document.getElementById("searchInput");
    const clearSearchBtn = document.getElementById("clearSearchBtn");
    const statsRow = document.getElementById("statsRow");

    const modal = document.getElementById("modal");
    const modalTitle = document.getElementById("modalTitle");
    const modalForm = document.getElementById("modalForm");
    const modalCancel = document.getElementById("modalCancel");
    const modalSave = document.getElementById("modalSave");

    /* Countdown */
    const countdownEl = document.getElementById("countdown");
    const countdownTimeEl = document.getElementById("countdownTime");
    const TARGET = new Date(2026, 7, 20, 0, 0, 0); // Aug is month 7 in JS

    function pad2(n){ return String(n).padStart(2, "0"); }

    function updateCountdown(){
      const now = new Date();
      let diff = TARGET.getTime() - now.getTime();

      if(diff <= 0){
        countdownTimeEl.textContent = "Live";
        return;
      }

      const sec = Math.floor(diff / 1000);
      const days = Math.floor(sec / 86400);
      const rem = sec % 86400;
      const hrs = Math.floor(rem / 3600);
      const mins = Math.floor((rem % 3600) / 60);
      const s = rem % 60;

      countdownTimeEl.textContent = `${days}d ${pad2(hrs)}:${pad2(mins)}:${pad2(s)}`;
    }

  countdownEl.addEventListener("click", () => {
  countdownEl.classList.remove("celebrate");
  void countdownEl.offsetWidth;
  countdownEl.classList.add("celebrate");

  burstConfettiFrom(countdownEl);
});


    setInterval(updateCountdown, 1000);
    updateCountdown();

    /* Navigation */
    function routeToHome(){
      state.hall = null;
      state.tab = "deskNotes";
      state.search = "";
      state.editing = null;
      render();
    }

    function routeToHall(hallName){
      state.hall = hallName;
      state.tab = "deskNotes";
      state.search = "";
      state.editing = null;
      markHallDeskNotesSeen(hallName);
      render();
    }

    function setTab(tabId){
      state.tab = tabId;
      state.search = "";
      state.editing = null;
      searchInput.value = "";
      if(state.tab === "deskNotes" && state.hall) markHallDeskNotesSeen(state.hall);
      render();
    }

    function nowTs(){ return Date.now(); }

    function nowString(){
      const d = new Date();
      const ds = d.toLocaleDateString(undefined, {year:"numeric", month:"short", day:"2-digit"});
      const ts = d.toLocaleTimeString(undefined, {hour:"numeric", minute:"2-digit"});
      return ds + " ‚Ä¢ " + ts;
    }

    function getHallData(){
      const all = store.loadAll();
      store.ensureHall(all, state.hall);
      return all;
    }

    function getRowsForTab(all){
      const hallObj = all.halls[state.hall];
      return hallObj[state.tab] || [];
    }

    function computeHallTotals(all, hall){
      store.ensureHall(all, hall);
      const h = all.halls[hall];
      return {
        calls: (h.callLog || []).length,
        mail: (h.mailList || []).length,
        lost: (h.lost || []).length,
        found: (h.found || []).length,
        notes: (h.deskNotes || []).length,
        docs: (h.docs || []).length,
      };
    }

    function getAllDeskNotesFeed(){
      const all = store.loadAll();
      const out = [];
      HALLS.forEach(h => {
        store.ensureHall(all, h);
        const notes = all.halls[h].deskNotes || [];
        notes.forEach(n => out.push({ ...n, _hall: h }));
      });
      out.sort((a,b) => Number(b._ts || 0) - Number(a._ts || 0));
      return out;
    }

    function markHallDeskNotesSeen(hall){
      const all = store.loadAll();
      store.ensureHall(all, hall);
      const notes = all.halls[hall].deskNotes || [];
      const latestTs = notes.reduce((m, n) => Math.max(m, Number(n._ts || 0)), 0);
      if(latestTs > 0) seen.setHallSeenAt(hall, latestTs);
    }

    function hallHasNewDeskNotes(hall){
      const all = store.loadAll();
      store.ensureHall(all, hall);
      const notes = all.halls[hall].deskNotes || [];
      const seenAt = seen.getHallSeenAt(hall);
      return notes.some(n => Number(n._ts || 0) > seenAt);
    }

    function renderHome(){
      hallRow.innerHTML = HALLS.map(h => {
        const isNew = hallHasNewDeskNotes(h);
        return `
          <div class="hall-card ${isNew ? "new" : ""}" onclick="appPickHall('${ea(h)}')">
            <span class="notif"></span>
            <div class="kicker">Select Hall</div>
            <div class="name">${e(h)}</div>
            <div class="sub">${isNew ? "New desk note update" : "No new desk notes"}</div>
          </div>
        `;
      }).join("");

      const feed = getAllDeskNotesFeed().slice(0, 12);
      if(feed.length === 0){
        feedList.innerHTML = `<div class="empty">No desk notes yet. Add a note in any hall and it will appear here.</div>`;
        return;
      }

      feedList.innerHTML = feed.map(n => {
        const seenAt = seen.getHallSeenAt(n._hall);
        const isNew = Number(n._ts || 0) > seenAt;
        return `
          <div class="feed-item ${isNew ? "new" : ""}">
            <div class="feed-top">
              <span class="chip">${e(n._hall)}</span>
              <span class="chip gray">${e(n.priority || "FYI")}</span>
            </div>
            <p class="feed-msg">${e(n.message || "")}</p>
            <div class="feed-meta">
              <span>By: ${e(n.addedBy || "")}</span>
              <span>Time: ${e(n.dateTime || "")}</span>
              <a href="#" onclick="appOpenHallNotes('${ea(n._hall)}');return false;">Open hall</a>
            </div>
          </div>
        `;
      }).join("");
    }

    function renderTabs(){
      tabsEl.innerHTML = TAB_DEFS.map(t => `
        <div class="tab ${t.id === state.tab ? "active" : ""}" onclick="appSetTab('${ea(t.id)}')">
          ${e(t.label)}
        </div>
      `).join("");
    }

    function renderHallHeader(){
      hallPill.style.display = "flex";
      homeBtn.style.display = "flex";
      hallPillText.textContent = state.hall;

      const hasNew = hallHasNewDeskNotes(state.hall);
      hallPillDot.style.display = hasNew ? "inline-block" : "none";

      homeBtn.onclick = routeToHome;
    }

    function renderStats(){
      const all = store.loadAll();
      const t = computeHallTotals(all, state.hall);

      const make = (label, value, highlight=false) => `
        <div class="stat ${highlight ? "highlight" : ""}">
          <div class="label">${e(label)}</div>
          <div class="value">${e(String(value))}</div>
        </div>
      `;

      statsRow.innerHTML =
        make("Calls", t.calls, true) +
        make("Mail", t.mail) +
        make("Lost", t.lost) +
        make("Found", t.found) +
        make("Notes", t.notes, true) +
        make("Docs", t.docs);
    }

    function renderHallControls(){
      addBtn.onclick = () => openModalForTab(state.tab);
      clearSearchBtn.onclick = () => {
        state.search = "";
        searchInput.value = "";
        renderContent();
      };
      searchInput.oninput = (ev) => {
        state.search = ev.target.value || "";
        renderContent();
      };
    }

    function getRowsFiltered(rows){
      const q = (state.search || "").toLowerCase();
      return q ? rows.filter(r => JSON.stringify(r).toLowerCase().includes(q)) : rows;
    }

    function renderContent(){
      const def = TAB_DEFS.find(t => t.id === state.tab);
      sectionTitle.textContent = def ? def.title : "Workspace";

      const all = getHallData();
      const rows = getRowsForTab(all);
      const filtered = getRowsFiltered(rows);

      if(state.tab === "callLog") renderCallLog(filtered);
      else if(state.tab === "mailList") renderMailList(filtered);
      else if(state.tab === "lost") renderLost(filtered);
      else if(state.tab === "found") renderFound(filtered);
      else if(state.tab === "deskNotes") renderDeskNotes(filtered);
      else if(state.tab === "docs") renderDocs(filtered);
      else contentArea.innerHTML = `<div class="empty">Unknown tab</div>`;

      renderStats();
    }

    function render(){
      if(!state.hall){
        homeView.style.display = "block";
        hallView.style.display = "none";
        hallPill.style.display = "none";
        homeBtn.style.display = "none";
        renderHome();
        return;
      }

      homeView.style.display = "none";
      hallView.style.display = "block";
      renderHallHeader();
      renderTabs();
      renderStats();
      renderHallControls();
      renderContent();
    }

    function actionsCellHTML(tabId, rowId){
      return `
        <div class="row-actions">
          <button class="icon-btn" title="Edit" onclick="appEdit('${ea(tabId)}','${ea(rowId)}')">‚úèÔ∏è</button>
          <button class="icon-btn" title="Delete" onclick="appDelete('${ea(tabId)}','${ea(rowId)}')">üóëÔ∏è</button>
        </div>
      `;
    }

    function priorityBadge(p){
      const v = (p || "FYI").toUpperCase();
      if(v === "URGENT") return `<span class="badge bad">Urgent</span>`;
      if(v === "IMPORTANT") return `<span class="badge warn">Important</span>`;
      return `<span class="badge gray">FYI</span>`;
    }

    function renderCallLog(rows){
      contentArea.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Caller</th><th>Phone</th><th>Call Date/Time</th><th>Message</th><th>Taken By</th><th>Best Callback</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td><strong>${e(r.whoCalled)}</strong></td>
                <td>${e(r.phoneNumber)}</td>
                <td>${e(r.callDateTime)}</td>
                <td>${e(r.message)}</td>
                <td><span class="badge gold">${e(r.takenBy)}</span></td>
                <td>${e(r.bestCallback)}</td>
                <td>${actionsCellHTML("callLog", r._id)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function renderMailList(rows){
      contentArea.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Recipient</th><th>From</th><th>Carrier</th><th>Tracking</th><th>Received</th><th>Stored</th><th>Status</th><th>Pickup Details</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td><strong>${e(r.recipient)}</strong></td>
                <td>${e(r.from)}</td>
                <td>${e(r.carrier)}</td>
                <td>${e(r.tracking)}</td>
                <td>${e(r.receivedDateTime)}</td>
                <td>${e(r.storageLocation)}</td>
                <td>${r.pickedUpDone ? `<span class="badge ok">Picked Up</span>` : `<span class="badge warn">At Desk</span>`}</td>
                <td>${r.pickedUpDone ? e(r.pickedUpDetails) : `<span class="badge gray">Not yet</span>`}</td>
                <td>${actionsCellHTML("mailList", r._id)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function renderLost(rows){
      contentArea.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Item</th><th>Owner</th><th>Contact</th><th>Lost Date/Time</th><th>Where Lost</th><th>Notes</th><th>Resolution</th><th>Status</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td><strong>${e(r.item)}</strong></td>
                <td>${e(r.owner)}</td>
                <td>${e(r.contact)}</td>
                <td>${e(r.lostDateTime)}</td>
                <td>${e(r.whereLost)}</td>
                <td>${e(r.notes)}</td>
                <td>${r.resolution ? e(r.resolution) : `<span class="badge gray">No update</span>`}</td>
                <td>${r.done ? `<span class="badge ok">Done</span>` : `<span class="badge warn">Open</span>`}</td>
                <td>${actionsCellHTML("lost", r._id)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function renderFound(rows){
      contentArea.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Item</th><th>Found Date/Time</th><th>Found Where</th><th>Added By</th><th>Notes</th><th>Status</th><th>Claim Details</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td><strong>${e(r.item)}</strong></td>
                <td>${e(r.foundDateTime)}</td>
                <td>${e(r.foundWhere)}</td>
                <td><span class="badge gold">${e(r.addedBy)}</span></td>
                <td>${e(r.notes)}</td>
                <td>${r.claimed ? `<span class="badge ok">Claimed</span>` : `<span class="badge warn">Unclaimed</span>`}</td>
                <td>${r.claimed ? e(r.claimDetails) : `<span class="badge gray">Not claimed</span>`}</td>
                <td>${actionsCellHTML("found", r._id)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function renderDeskNotes(rows){
      contentArea.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Added By</th><th>Date/Time</th><th>Message</th><th>Priority</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td><strong>${e(r.addedBy)}</strong></td>
                <td>${e(r.dateTime)}</td>
                <td>${e(r.message)}</td>
                <td>${priorityBadge(r.priority)}</td>
                <td>${actionsCellHTML("deskNotes", r._id)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function renderDocs(rows){
      contentArea.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Document</th><th>Link</th><th>Notes</th><th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td><strong>${e(r.name)}</strong></td>
                <td>${r.url ? `<a href="${ea(r.url)}" target="_blank">${e(r.url)}</a>` : `<span class="badge gray">No link</span>`}</td>
                <td>${e(r.notes)}</td>
                <td>${actionsCellHTML("docs", r._id)}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function openModalForTab(tabId, rowId = null){
      state.editing = rowId;
      const isEdit = !!rowId;

      const titleMap = {
        callLog: isEdit ? "Edit Call Log" : "Add Call Log",
        mailList: isEdit ? "Edit Mail Entry" : "Add Mail Entry",
        lost: isEdit ? "Edit Lost Item" : "Add Lost Item",
        found: isEdit ? "Edit Found Item" : "Add Found Item",
        deskNotes: isEdit ? "Edit Desk Note" : "Add Desk Note",
        docs: isEdit ? "Edit Document" : "Add Document",
      };
      modalTitle.textContent = titleMap[tabId] || (isEdit ? "Edit Entry" : "Add Entry");

      const all = getHallData();
      const rows = all.halls[state.hall][tabId] || [];
      const row = rowId ? rows.find(r => r._id === rowId) : null;
      const v = (x)=> (x ?? "");

      if(tabId === "callLog"){
        modalForm.innerHTML = `
          <div><label>Who called</label><input id="whoCalled" value="${ea(v(row?.whoCalled))}"/></div>
          <div><label>Phone number</label><input id="phoneNumber" value="${ea(v(row?.phoneNumber))}"/></div>
          <div class="full"><label>Call date and time</label><input id="callDateTime" value="${ea(v(row?.callDateTime) || nowString())}"/></div>
          <div class="full"><label>Message</label><textarea id="message">${e(v(row?.message))}</textarea></div>
          <div><label>Who took the call</label><input id="takenBy" value="${ea(v(row?.takenBy))}"/></div>
          <div><label>Best time/date to call back</label><input id="bestCallback" value="${ea(v(row?.bestCallback))}"/></div>
        `;
      }

      if(tabId === "mailList"){
        modalForm.innerHTML = `
          <div><label>Recipient</label><input id="recipient" value="${ea(v(row?.recipient))}"/></div>
          <div><label>From</label><input id="from" value="${ea(v(row?.from))}"/></div>
          <div><label>Carrier</label><input id="carrier" value="${ea(v(row?.carrier))}"/></div>
          <div><label>Tracking</label><input id="tracking" value="${ea(v(row?.tracking))}"/></div>
          <div class="full"><label>Received date and time</label><input id="receivedDateTime" value="${ea(v(row?.receivedDateTime) || nowString())}"/></div>
          <div><label>Stored location</label><input id="storageLocation" value="${ea(v(row?.storageLocation))}"/></div>
          <div><label>Status</label>
            <select id="pickedUpDone">
              <option value="false">At Desk</option>
              <option value="true">Picked Up</option>
            </select>
          </div>
          <div class="full"><label>Pickup details</label><input id="pickedUpDetails" value="${ea(v(row?.pickedUpDetails))}"/></div>
        `;
      }

      if(tabId === "lost"){
        modalForm.innerHTML = `
          <div><label>Item</label><input id="item" value="${ea(v(row?.item))}"/></div>
          <div><label>Owner</label><input id="owner" value="${ea(v(row?.owner))}"/></div>
          <div class="full"><label>Contact</label><input id="contact" value="${ea(v(row?.contact))}"/></div>
          <div><label>Lost date and time</label><input id="lostDateTime" value="${ea(v(row?.lostDateTime) || nowString())}"/></div>
          <div><label>Where lost</label><input id="whereLost" value="${ea(v(row?.whereLost))}"/></div>
          <div class="full"><label>Notes</label><textarea id="notes">${e(v(row?.notes))}</textarea></div>
          <div class="full"><label>Resolution update</label><textarea id="resolution">${e(v(row?.resolution))}</textarea></div>
          <div><label>Status</label>
            <select id="done">
              <option value="false">Open</option>
              <option value="true">Done</option>
            </select>
          </div>
          <div><label>Tag</label><input id="tag" value="${ea(v(row?.tag))}"/></div>
        `;
      }

      if(tabId === "found"){
        modalForm.innerHTML = `
          <div><label>Item</label><input id="item" value="${ea(v(row?.item))}"/></div>
          <div><label>Found date and time</label><input id="foundDateTime" value="${ea(v(row?.foundDateTime) || nowString())}"/></div>
          <div><label>Found where</label><input id="foundWhere" value="${ea(v(row?.foundWhere))}"/></div>
          <div><label>Added by</label><input id="addedBy" value="${ea(v(row?.addedBy))}"/></div>
          <div class="full"><label>Notes</label><textarea id="notes">${e(v(row?.notes))}</textarea></div>
          <div><label>Status</label>
            <select id="claimed">
              <option value="false">Unclaimed</option>
              <option value="true">Claimed</option>
            </select>
          </div>
          <div class="full"><label>Claim details</label><input id="claimDetails" value="${ea(v(row?.claimDetails))}"/></div>
        `;
      }

      if(tabId === "deskNotes"){
        modalForm.innerHTML = `
          <div><label>Added by</label><input id="addedBy" value="${ea(v(row?.addedBy))}"/></div>
          <div><label>Date and time</label><input id="dateTime" value="${ea(v(row?.dateTime) || nowString())}"/></div>
          <div><label>Priority</label>
            <select id="priority">
              <option>FYI</option>
              <option>Important</option>
              <option>Urgent</option>
            </select>
          </div>
          <div class="full"><label>Message</label><textarea id="message">${e(v(row?.message))}</textarea></div>
        `;
      }

      if(tabId === "docs"){
        modalForm.innerHTML = `
          <div><label>Document name</label><input id="name" value="${ea(v(row?.name))}"/></div>
          <div><label>URL</label><input id="url" value="${ea(v(row?.url))}"/></div>
          <div class="full"><label>Notes</label><input id="notes" value="${ea(v(row?.notes))}"/></div>
        `;
      }

      modal.classList.add("active");

      if(tabId === "mailList") document.getElementById("pickedUpDone").value = (row?.pickedUpDone ? "true" : "false");
      if(tabId === "lost") document.getElementById("done").value = (row?.done ? "true" : "false");
      if(tabId === "found") document.getElementById("claimed").value = (row?.claimed ? "true" : "false");
      if(tabId === "deskNotes") document.getElementById("priority").value = v(row?.priority) || "FYI";

      modalSave.onclick = () => saveModal(tabId, rowId);
    }

    function closeModal(){
      modal.classList.remove("active");
      modalForm.innerHTML = "";
      state.editing = null;
    }

    modalCancel.onclick = closeModal;
    modal.addEventListener("click", (ev) => { if(ev.target === modal) closeModal(); });
    document.addEventListener("keydown", (ev) => { if(ev.key === "Escape") closeModal(); });

    function readInput(id){
      const el = document.getElementById(id);
      return el ? el.value.trim() : "";
    }

    function saveModal(tabId, rowId){
      const all = getHallData();
      const rows = all.halls[state.hall][tabId] || [];

      function upsert(obj){
        if(!rowId){
          obj._id = uid();
          obj._ts = nowTs();
          rows.unshift(obj);
        } else {
          const idx = rows.findIndex(r => r._id === rowId);
          if(idx >= 0) rows[idx] = { ...rows[idx], ...obj, _ts: rows[idx]._ts || nowTs() };
        }
        all.halls[state.hall][tabId] = rows;
        store.saveAll(all);
      }

      if(tabId === "callLog"){
        const whoCalled = readInput("whoCalled");
        const phoneNumber = readInput("phoneNumber");
        const callDateTime = readInput("callDateTime") || nowString();
        const message = readInput("message");
        const takenBy = readInput("takenBy");
        const bestCallback = readInput("bestCallback");
        if(!whoCalled || !message) return;
        upsert({ whoCalled, phoneNumber, callDateTime, message, takenBy, bestCallback });
      }

      if(tabId === "mailList"){
        const recipient = readInput("recipient");
        const from = readInput("from");
        const carrier = readInput("carrier");
        const tracking = readInput("tracking");
        const receivedDateTime = readInput("receivedDateTime") || nowString();
        const storageLocation = readInput("storageLocation");
        const pickedUpDone = (readInput("pickedUpDone") === "true");
        const pickedUpDetails = readInput("pickedUpDetails");
        if(!recipient) return;
        upsert({ recipient, from, carrier, tracking, receivedDateTime, storageLocation, pickedUpDone, pickedUpDetails });
      }

      if(tabId === "lost"){
        const item = readInput("item");
        const owner = readInput("owner");
        const contact = readInput("contact");
        const lostDateTime = readInput("lostDateTime") || nowString();
        const whereLost = readInput("whereLost");
        const notes = readInput("notes");
        const resolution = readInput("resolution");
        const done = (readInput("done") === "true");
        const tag = readInput("tag");
        if(!item) return;
        upsert({ item, owner, contact, lostDateTime, whereLost, notes, resolution, done, tag });
      }

      if(tabId === "found"){
        const item = readInput("item");
        const foundDateTime = readInput("foundDateTime") || nowString();
        const foundWhere = readInput("foundWhere");
        const addedBy = readInput("addedBy");
        const notes = readInput("notes");
        const claimed = (readInput("claimed") === "true");
        const claimDetails = readInput("claimDetails");
        if(!item) return;
        upsert({ item, foundDateTime, foundWhere, addedBy, notes, claimed, claimDetails });
      }

      if(tabId === "deskNotes"){
        const addedBy = readInput("addedBy");
        const dateTime = readInput("dateTime") || nowString();
        const priority = readInput("priority") || "FYI";
        const message = readInput("message");
        if(!addedBy || !message) return;
        upsert({ addedBy, dateTime, priority, message });
      }

      if(tabId === "docs"){
        const name = readInput("name");
        const url = readInput("url");
        const notes = readInput("notes");
        if(!name) return;
        upsert({ name, url, notes });
      }

      closeModal();
      render();
    }

    function deleteRow(tabId, rowId){
      if(!confirm("Delete this entry?")) return;
      const all = getHallData();
      const rows = all.halls[state.hall][tabId] || [];
      all.halls[state.hall][tabId] = rows.filter(r => r._id !== rowId);
      store.saveAll(all);
      render();
    }

    function editRow(tabId, rowId){
      state.tab = tabId;
      render();
      openModalForTab(tabId, rowId);
    }

    markSeenBtn.onclick = () => {
      const feed = getAllDeskNotesFeed();
      const latest = feed.reduce((m,n) => Math.max(m, Number(n._ts || 0)), 0);
      if(latest > 0) seen.markAllSeen(latest);
      render();
    };

    function renderHallControls(){
      addBtn.onclick = () => openModalForTab(state.tab);
      clearSearchBtn.onclick = () => { state.search=""; searchInput.value=""; renderContent(); };
      searchInput.oninput = (ev) => { state.search = ev.target.value || ""; renderContent(); };
    }

    function renderStats(){
      const all = store.loadAll();
      const t = computeHallTotals(all, state.hall);

      const make = (label, value, highlight=false) => `
        <div class="stat ${highlight ? "highlight" : ""}">
          <div class="label">${e(label)}</div>
          <div class="value">${e(String(value))}</div>
        </div>
      `;
      statsRow.innerHTML =
        make("Calls", t.calls, true) +
        make("Mail", t.mail) +
        make("Lost", t.lost) +
        make("Found", t.found) +
        make("Notes", t.notes, true) +
        make("Docs", t.docs);
    }

    function renderTabs(){
      tabsEl.innerHTML = TAB_DEFS.map(t => `
        <div class="tab ${t.id === state.tab ? "active" : ""}" onclick="appSetTab('${ea(t.id)}')">
          ${e(t.label)}
        </div>
      `).join("");
    }

    function renderHallHeader(){
      hallPill.style.display = "flex";
      homeBtn.style.display = "flex";
      hallPillText.textContent = state.hall;
      hallPillDot.style.display = hallHasNewDeskNotes(state.hall) ? "inline-block" : "none";
      homeBtn.onclick = routeToHome;
    }

    function renderContent(){
      const def = TAB_DEFS.find(t => t.id === state.tab);
      sectionTitle.textContent = def ? def.title : "Workspace";

      const all = getHallData();
      const rows = getRowsForTab(all);
      const filtered = getRowsFiltered(rows);

      if(state.tab === "callLog") renderCallLog(filtered);
      else if(state.tab === "mailList") renderMailList(filtered);
      else if(state.tab === "lost") renderLost(filtered);
      else if(state.tab === "found") renderFound(filtered);
      else if(state.tab === "deskNotes") renderDeskNotes(filtered);
      else if(state.tab === "docs") renderDocs(filtered);

      renderStats();
    }

    function render(){
      if(!state.hall){
        homeView.style.display = "block";
        hallView.style.display = "none";
        hallPill.style.display = "none";
        homeBtn.style.display = "none";
        renderHome();
        return;
      }
      homeView.style.display = "none";
      hallView.style.display = "block";
      renderHallHeader();
      renderTabs();
      renderHallControls();
      renderContent();
    }

    window.appPickHall = (hall) => routeToHall(hall);
    window.appSetTab = (tab) => setTab(tab);
    window.appDelete = (tab, id) => deleteRow(tab, id);
    window.appEdit = (tab, id) => editRow(tab, id);
    window.appOpenHallNotes = (hall) => { routeToHall(hall); setTab("deskNotes"); };

    (function boot(){ render(); })();
  </script>
</body>
</html>
